/**
 * Copyright © 2026, PhotoStructure Inc. All rights reserved.
 *
 * BY USING THIS SOFTWARE, YOU ACCEPT ALL OF THE TERMS IN
 * https://photostructure.com/eula
 * IF YOU DO NOT ACCEPT THESE TERMS, DO NOT USE THIS SOFTWARE
 */
import{d as M,r as K,c as x,F as D,k as o,B as l,m as e,g as I,l as g,E as d,t as z,z as b,j as R,P as q,Q as U,N as J,a2 as V,_ as P,T as it,f as B,u as t,a3 as X,U as Z,a4 as tt,n as et,A as _,a5 as rt,W as ut,C as W}from"./Touch.js";import{u as st,a as Q,i as at,b as ct,c as dt,d as mt,e as gt,t as ht,f as pt,g as Y,h as vt,j as ft,n as yt,k as bt,l as kt,T as G,m as Ct,o as Pt}from"./app.js";import{_ as j,a as wt}from"./TagBreadcrumb.vue_vue_type_script_setup_true_lang.js";import{t as _t,V as St,j as F,W as Tt}from"./Blank.js";import{s as $t,b as xt}from"./Lazy.js";import{m as lt}from"./Maybe.js";import{m as It}from"./AssetQuery.js";import{_ as At}from"./DropDown.vue_vue_type_script_setup_true_lang.js";import{_ as Lt,a as Rt,b as qt}from"./NavMenuButton.vue_vue_type_script_setup_true_lang.js";import"./StickyHeader.js";import"./fe.js";import"./Random.js";function Ft(n,u){return _t(n).filter(r=>r!=null).map((r,y)=>({item:r,cmp:lt(u(r,y),p=>[p,y])})).filter(r=>r.cmp!=null).sort((r,y)=>St(r.cmp,y.cmp)).map(r=>r.item)}$t("processing","paused","done");const zt="rebuilding://",Ut={class:"summary"},Bt={class:"volume"},Mt=["src"],Et={key:0,class:"progress dropIn"},Ht=["title"],Nt=["title"],Vt=["title"],jt={key:1,class:"progress dropIn"},Dt={key:0,class:"dek"},Qt={key:0},Wt=M({__name:"ProgressPanel",props:{uri:{},volume:{},state:{},hed:{},dek:{},completePct:{},incompletePct:{},scanningPct:{},recentAssetIds:{}},setup(n){const u=n,r=K(!1),y=x(()=>(u.recentAssetIds??[]).filter(f=>f!=null)),p=x(()=>zt===u.uri),k=x(()=>F(u.dek));function a(){r.value=!r.value}function S(f){return"width:"+f.toFixed()+"%"}return(f,T)=>{const $=D("router-link");return l(),o("div",{class:b(["details",r.value?"open":"closed"]),onClick:a},[e("div",Ut,[e("div",Bt,z(n.volume),1),e("span",{class:b(["hed",n.state])},z(n.hed),3),d(J,{tag:"div",class:"recent-assets",name:"slide"},{default:R(()=>[(l(!0),o(q,null,U(y.value,C=>(l(),I($,{class:"slide-item",key:C,to:{name:"asset",params:{assetId:C}}},{default:R(()=>[e("img",{class:"thumb slide-item",src:"/img/"+C+"/sq/60"},null,8,Mt)]),_:2},1032,["to"]))),128))]),_:1}),n.state==="processing"?(l(),o("div",Et,[n.completePct?(l(),o("span",{key:0,class:"complete",title:n.completePct+"% done",style:V(S(n.completePct))},null,12,Ht)):g("",!0),n.incompletePct?(l(),o("span",{key:1,class:"incomplete",title:n.incompletePct+"% todo",style:V(S(n.incompletePct))},null,12,Nt)):g("",!0),n.scanningPct?(l(),o("span",{key:2,class:"scanning",title:n.scanningPct+"% of this volume remains to be scanned",style:V(S(n.scanningPct))},null,12,Vt)):g("",!0)])):(l(),o("div",jt,[e("span",{class:b(n.state),style:{width:"100%"}},null,2)]))]),k.value?(l(),I(P,{key:0,icon:"expand_less"})):g("",!0),k.value?(l(),I(it,{key:1,name:"drop"},{default:R(()=>[r.value?(l(),o("ul",Dt,[(l(!0),o(q,null,U(n.dek,(C,w)=>(l(),o("li",{key:w},z(C),1))),128)),p.value?(l(),o("li",Qt,[...T[0]||(T[0]=[e("a",{href:"https://photostructure.com/faq/library-rebuilds/",target:"_blank"},"Read more…",-1)])])):g("",!0)])):g("",!0)]),_:1})):g("",!0)],2)}}}),Yt=M({__name:"ProgressPanels",setup(n){const u=st(),{states:r}=B(u);return(y,p)=>t(F)(t(r))?(l(),I(J,{key:0,tag:"div",class:"progress-panels dropin",name:"drop"},{default:R(()=>[(l(!0),o(q,null,U(t(r),k=>(l(),I(Wt,X({class:"drop-item user-select-text"},{ref_for:!0},k,{key:k.volume}),null,16))),128))]),_:1})):g("",!0)}}),Gt={key:0,class:"duration"},O=M({__name:"TagGallery",props:{tag:{},sample:{type:Boolean},siblingTagCount:{}},setup(n){const u=n,r=Q(),{thumbSize:y,thumbCols:p,thumbFit:k,actualThumbRows:a}=B(r),S=x(()=>k.value==="square"),f=x(()=>{if(u.sample){const m=p.value,h=a.value,c=u.tag.assetIds.slice(0,Math.floor(h*m));return Ft(c,v=>-v.capturedAtLocal)}else return u.tag.assetIds}),T=x(()=>["gallery",u.sample?"sample":"leaf",y.value]);function $(m){return dt({assetId:m})}function C(m){return mt({assetId:m,lazyLoad:!0,size:y.value})}function w(m){return gt({assetId:m,lazyLoad:!0,widths:[ht(y.value)],reducer:"fit"})}function A(){et(()=>{at().onChange()})}return Z(A),tt(A),(m,h)=>{const c=D("router-link");return t(F)(n.tag.assetIds)?(l(),o("div",{class:b(T.value),key:n.tag.tagId},[(l(!0),o(q,null,U(f.value,v=>(l(),I(c,{to:$(v),key:t(k)+"-asset:"+t(ct)(v)},{default:R(()=>[e("img",X({class:["thumb",t(k)]},{ref_for:!0},S.value?C(v):w(v)),null,16),v.durationHMS?(l(),o("span",Gt,z(v.durationHMS),1)):g("",!0)]),_:2},1032,["to"]))),128))],2)):g("",!0)}}}),Ot={class:"tag-header left-middle-right"},Kt={class:"no-drag left"},Jt={class:"right"},Xt={key:1},Zt={class:"dropdown-row"},te={class:"button-group"},ee=["value"],se=["value"],ae={class:"dropdown-row"},le={class:"button-group"},ne={class:"dropdown-row"},oe={class:"button-group"},ie={class:"button-group hide-on-l"},re=["value"],ue=["value"],ce=["title"],de={class:"button-group no-drag hide-on-l"},me=M({__name:"TagHeader",props:{tagPath:{},displayPath:{},assetCount:{},allChildren:{},isRoot:{type:Boolean},replace:{type:Boolean}},setup(n){const u=n,r=Q(),{thumbFit:y,thumbSize:p,thumbFitIcon:k,thumbFitToggleTitle:a,actualThumbRows:S,disableDecrRows:f,disableIncrRows:T,maxThumbRows:$}=B(r),{setThumbFit:C,setThumbSize:w,cycleFit:A,decrRows:m,incrRows:h,setThumbRows:c}=r,v=pt(),{fullscreen:L}=B(v),{toggle:E}=v,N=x(()=>{const H={path:"/search"};return u.tagPath?.length===1?H.query={q:u.tagPath[0]}:u.tagPath?.length>1&&(H.query={q:`${u.tagPath[0]}:${It(u.tagPath.slice(1).join("/"))}`}),H}),nt=x(()=>u.tagPath?.length>1?"Search within "+u.displayPath.join(" / "):"Search");return(H,s)=>{const ot=D("router-link");return l(),o("header",Ot,[e("div",Kt,[d(Lt),d(Rt),d(ot,{class:"no-drag vicon hide-on-m",to:N.value,"data-key":"/","data-key2":"s",title:nt.value,replace:n.replace},{default:R(()=>[d(P,{icon:"search"})]),_:1},8,["to","title","replace"])]),d(j,{tagPath:n.tagPath,displayPath:n.displayPath,assetCount:n.assetCount,allChildren:n.allChildren,includeHomeButton:!0,noSticky:!0,replace:n.replace},null,8,["tagPath","displayPath","assetCount","allChildren","replace"]),e("div",Jt,[d(qt,{class:"hide-on-l"}),d(At,{class:"header-overflow only-on-l",title:"View options"},{dropdown:R(()=>[t(Y)?(l(),o("a",{key:0,onClick:s[0]||(s[0]=(...i)=>t(E)&&t(E)(...i))},[d(P,{icon:t(L)?"fullscreen_exit":"fullscreen"},null,8,["icon"]),e("span",null,z(t(L)?"Exit full screen":"Full screen"),1)])):g("",!0),t(Y)?(l(),o("hr",Xt)):g("",!0),e("div",Zt,[s[16]||(s[16]=e("span",{class:"label",title:"How many rows of thumbnails should we show when sampling a child tag?"},"Sample Rows",-1)),e("div",te,[e("button",{class:b({disabled:t(f)}),title:"Fewer rows",onClick:s[1]||(s[1]=i=>t(m)())},[d(P,{icon:"minus"})],2),e("select",{class:"row-input",value:t(S),title:"Number of sample rows",onChange:s[2]||(s[2]=i=>t(c)(+i.target.value))},[(l(!0),o(q,null,U(t($),i=>(l(),o("option",{key:i,value:i},z(i),9,se))),128))],40,ee),e("button",{class:b({disabled:t(T)}),title:"More rows",onClick:s[3]||(s[3]=i=>t(h)())},[d(P,{icon:"plus"})],2)])]),e("div",ae,[s[19]||(s[19]=e("span",{class:"label"},"Fit",-1)),e("div",le,[e("button",{class:b({selected:t(y)=="square"}),title:"Square thumbnails",onClick:s[4]||(s[4]=i=>t(C)("square"))},[d(P,{icon:"grid_square"}),s[17]||(s[17]=_(" Square ",-1))],2),e("button",{class:b({selected:t(y)=="aspect"}),title:"Original aspect ratio",onClick:s[5]||(s[5]=i=>t(C)("aspect"))},[d(P,{icon:"grid_aspect"}),s[18]||(s[18]=_(" Original ",-1))],2)])]),e("div",ne,[s[20]||(s[20]=e("span",{class:"label"},"Size",-1)),e("div",oe,[e("button",{class:b({selected:t(p)=="s"}),title:"Small",onClick:s[6]||(s[6]=i=>t(w)("s"))}," Small ",2),e("button",{class:b({selected:t(p)=="m"}),title:"Medium",onClick:s[7]||(s[7]=i=>t(w)("m"))}," Medium ",2),e("button",{class:b({selected:t(p)=="l"}),title:"Large",onClick:s[8]||(s[8]=i=>t(w)("l"))}," Large ",2)])])]),default:R(()=>[d(P,{icon:"more_vert"})]),_:1}),e("div",ie,[e("button",{class:b({disabled:t(f)}),title:"Show fewer samples",onClick:s[9]||(s[9]=i=>t(m)()),"data-key":"-"},[d(P,{icon:"minus"})],2),e("select",{class:"thumb-rows",value:t(S),title:"How many rows of samples should be shown for the current thumbsize?",onChange:s[10]||(s[10]=i=>t(c)(+i.target.value))},[(l(!0),o(q,null,U(t($),i=>(l(),o("option",{key:i,value:i},z(i),9,ue))),128))],40,re),e("button",{class:b({disabled:t(T)}),title:"Show more samples",onClick:s[11]||(s[11]=i=>t(h)()),"data-key":"="},[d(P,{icon:"plus"})],2)]),e("a",{class:"no-drag vicon hide-on-l",onClick:s[12]||(s[12]=(...i)=>t(A)&&t(A)(...i)),title:t(a),"data-key":"g"},[d(P,{icon:t(k)},null,8,["icon"])],8,ce),e("div",de,[e("button",{class:b({selected:t(p)=="s"}),title:"Small thumbnails",onClick:s[13]||(s[13]=i=>t(w)("s"))},[d(P,{icon:"sq_x4"})],2),e("button",{class:b({selected:t(p)=="m"}),title:"Medium thumbnails",onClick:s[14]||(s[14]=i=>t(w)("m"))},[d(P,{icon:"sq_x3"})],2),e("button",{class:b({selected:t(p)=="l"}),title:"Large thumbnails",onClick:s[15]||(s[15]=i=>t(w)("l"))},[d(P,{icon:"sq_x2"})],2)])])])}}}),ge={class:"tag page"},he={key:1,class:"if-empty reveal"},pe={key:0},ve={key:1},fe={key:2,class:"child-tags"},ye=["data-url"],be=["data-url"],Re=M({__name:"Tag",props:{fullPath:{}},setup(n){const u=n,r=vt(),y=Q(),p=st(),{thumbFit:k}=B(y),a=K(void 0),S=x(()=>/^\/tag\/?$/.test(r.path));let f,T=!1;function $(){f!=null&&(clearTimeout(f),f=void 0),C(!0)}async function C(m=!1){if(!m&&u.fullPath===a.value?.fullPath&&k.value===a.value?.fit)return;const h="/api"+kt(u.fullPath,{fit:k.value});if(a.value=await W(h),m)a.value!=null&&a.value.assetCount>G&&p.unregisterTagsRefreshCallback();else{if(a.value==null)return;S.value?(document.title="Home - PhotoStructure",a.value.assetCount<G&&(Pt()&&p.resumeSSE(),p.registerTagsRefreshCallback($),!T&&a.value.assetCount===0&&(T=!0,f=xt($,2e3)))):lt(a.value?.tagPath,c=>document.title=c.join("/")+" - PhotoStructure")}}async function w(m){if(a.value==null||m==null||!Ct(m))return;const h=m.getAttribute("data-url");if(h==null)return;m.removeAttribute("data-url");const c=await W(h);if(c==null)return;const v=a.value;if(v!=null){if(m.classList.contains("next-child-tags")){const L=c;v.childTags.push(...L.childTags.filter(E=>!v.childTags.some(N=>N.tagId===E.tagId))),v.nextChildTags=L.nextChildTags}else if(m.classList.contains("next-assets")){const L=c;Tt(v.assetIds,...L.assetIds),v.nextAssets=L.nextAssets}}}function A(){f!=null&&(clearTimeout(f),f=void 0),p.unregisterTagsRefreshCallback()}return Z(()=>{C()}),rt(()=>{C()}),tt(()=>{et(()=>{wt(),at().onChange(),ft().onChange(),a.value==null&&A()})}),ut(()=>{A()}),(m,h)=>(l(),o("div",ge,[a.value!=null?(l(),o(q,{key:0},[d(me,{tagPath:a.value.tagPath,displayPath:a.value.displayPath,assetCount:a.value.assetCount,allChildren:a.value.allChildren},null,8,["tagPath","displayPath","assetCount","allChildren"]),e("main",null,[S.value?(l(),I(Yt,{key:0})):g("",!0),a.value.startingUp||a.value.emptyLibrary?(l(),o("div",he,[a.value.startingUp?(l(),o("div",pe,[...h[2]||(h[2]=[e("h2",null,"Starting synchronization...",-1),e("p",null," This initial import of all photos and videos may take a while. You may want to leave your computer plugged in and running overnight. ",-1),e("p",null,[_(" See "),e("a",{href:"/about",target:"_blank"},"the about page"),_(" for diagnostics and support. ")],-1),e("p",null,[_(" You might want to check out our "),e("a",{href:"https://photostructure.com/getting-started/post-install-protips/",target:"_blank"},"post-installation tips"),_(" to help you get started. ")],-1)])])):g("",!0),a.value.emptyLibrary?(l(),o("div",ve,[...h[3]||(h[3]=[e("h2",null,"Your library is currently empty",-1),e("p",null,[_(" If sync hasn't found any assets, you can change where PhotoStructure looks for photos and videos in "),e("a",{href:"/settings"},"settings"),_(". ")],-1),e("p",null,[_(" See the "),e("a",{href:"/about",target:"_blank"},"about page"),_(" for documentation and support information. ")],-1),e("p",null,[_(" See the "),e("a",{href:"/health"},"health page"),_(" for library diagnostics. ")],-1)])])):g("",!0)])):g("",!0),t(F)(a.value.childTags)?(l(),o("div",fe,[(l(!0),o(q,null,U(a.value.childTags,c=>(l(),o("div",{key:"child:"+c.tagId,class:"child-tag"},[t(F)(c.assetIds)?(l(),I(j,{key:0,tagPath:c.tagPath,displayPath:c.displayPath,assetCount:c.assetCount},null,8,["tagPath","displayPath","assetCount"])):g("",!0),d(O,{tag:c,sample:!0,siblingTagCount:a.value.childTagCount},null,8,["tag","siblingTagCount"])]))),128))])):g("",!0),a.value.nextChildTags?(l(),o("div",{key:3,class:"intersection-target next-btn next-child-tags reveal2s","data-url":t(yt)(a.value.tagId,a.value.nextChildTags),onClick:h[0]||(h[0]=c=>w(c.target))}," Load more… ",8,ye)):g("",!0),t(F)(a.value.assetIds)&&t(F)(a.value.childTags)?(l(),I(j,{key:4,tagPath:a.value.tagPath,displayPath:a.value.displayPath},null,8,["tagPath","displayPath"])):g("",!0),d(O,{tag:a.value,sample:!1},null,8,["tag"]),a.value.nextAssets?(l(),o("div",{key:5,class:"intersection-target next-btn next-assets reveal2s","data-url":t(bt)(a.value.tagId,a.value.nextAssets),onClick:h[1]||(h[1]=c=>w(c.target))}," Load more… ",8,be)):g("",!0)])],64)):g("",!0)]))}});export{Re as default};
