/**
 * Copyright © 2026, PhotoStructure Inc. All rights reserved.
 *
 * BY USING THIS SOFTWARE, YOU ACCEPT ALL OF THE TERMS IN
 * https://photostructure.com/eula
 * IF YOU DO NOT ACCEPT THESE TERMS, DO NOT USE THIS SOFTWARE
 */
import{d as Fe,f as oe,r as q,c as I,U as Qe,a5 as Ee,w as re,k as d,m as s,E as r,j as p,F as ne,o as Ne,q as Re,_ as l,a8 as Le,u as n,z as m,l as b,A as y,t as x,g as le,P as E,Q as N,C as R,R as T,B as u,n as ze}from"./Touch.js";import{a as Be,B as De,f as Ve,C as je,h as Ue,z as We,D as Ye,i as L,j as ae,m as He,g as ie,b as Je}from"./app.js";import{A as z}from"./AssetQuery.js";import{H as Ge,j as B,_ as Ke,$ as ue,a0 as Xe,c as P,b as w,i as ce,W as Ze,n as de,I as et,a as tt}from"./Blank.js";import{t as fe,_ as st}from"./AssetThumb.vue_vue_type_script_setup_true_lang.js";import{_ as ot}from"./DropDown.vue_vue_type_script_setup_true_lang.js";import{_ as rt,a as nt,b as lt}from"./NavMenuButton.vue_vue_type_script_setup_true_lang.js";import{l as me,b as D,i as V,t as F,a as at,w as ve,y as it}from"./Lazy.js";import"./StickyHeader.js";import"./fe.js";import"./Maybe.js";import"./Random.js";const ut={class:"search page user-select-none dark-bg"},ct={class:"search-header left-middle-right"},dt={class:"no-drag left"},ft={type:"submit"},mt=["title"],vt={class:"right"},yt={key:1},pt={class:"dropdown-row"},ht={class:"button-group"},bt={class:"dropdown-row"},gt={class:"button-group"},kt={class:"dropdown-row"},qt={class:"button-group"},wt=["title"],St={class:"button-group no-drag hide-on-l"},_t={key:0,class:"banner no-drag user-select-text sticky"},Ct=["title"],xt={class:"searches"},Tt={key:0},At={class:"searches"},Ot={href:"https://photostructure.com/faq/search/",target:"_blank"},Mt={href:"https://forum.photostructure.com/t/please-suggest-other-example-searches/467",target:"_blank"},jt=Fe({__name:"Search",setup($t){const c=Ue(),Q=Ye(),j=Be(),ye=De(),U=Ve(),{thumbSize:g,thumbFit:A,thumbFitIcon:pe,thumbFitToggleTitle:he}=oe(j),{cycleFit:W,setThumbSize:S,setThumbFit:Y}=j,{fullscreen:H}=oe(U),{toggle:J}=U,C=q(""),k=q(void 0),h=q(void 0),a=q(void 0),be=q(void 0),G=q(null),v=q([]),K=Ge(window.localStorage?.getItem("priorQueries"));Array.isArray(K)&&(v.value=K);const X={orderby:z.updatedAt,asc:!1,title:"Recently updated",icon:"sort_upd"},O=[{orderby:z.capturedAt,asc:!1,title:"Newest first",icon:"sort_desc"},{orderby:z.capturedAt,asc:!0,title:"Oldest first",icon:"sort_asc"}],ge=[X,...O];function Z(t){const e={q:t.q};return t.orderby!=null&&(e.orderby=t.orderby),t.asc!=null&&(e.asc=String(t.asc)),t.title!=null&&(e.title=t.title),t.icon!=null&&(e.icon=t.icon),e}function ke(t){return t==null||w(t)?void 0:Array.isArray(t)?t.join(" "):P(t)}function _(t){const e=ke(t?.orderby),i=Ke(t?.asc);if(e==null&&!i)return O[0];const f=ge.find(o=>o.asc===i&&o.orderby===e);return f??{orderby:e??O[0].orderby,asc:i,title:"Order by "+(e??O[0].orderby)+", "+(i?"ascending":"descending"),icon:i?"sort_asc":"sort_desc"}}function M(){return F()-1}function qe(){const t=Date.now()-it,e=ve/1.3;return"after:"+V(t-e)+" before:"+V(t+e)}const ee=me(()=>[{icon:"favorite",query:{q:"liked:true"},desc:"Liked"},{icon:"sync_alt",query:{q:"updated:>"+V(Date.now()-ve),...X},desc:"Recently updated"},{icon:"event",query:{q:"date:"+F()},desc:"Assets taken in "+F()},{icon:"event",query:{q:"date:"+M()},desc:"Assets taken in "+M()},{icon:"history",query:{q:qe()},desc:"This week, 1 year ago"},{icon:"history",query:{q:"date:<"+(F()-5)},desc:"Assets taken more than 5 years ago"},{icon:"movie",query:{q:"type:video AND date:"+M()},desc:"Movies taken in "+M()},{icon:"archive",query:{q:"archived:true"},desc:"View archive"},{icon:"library_remove",query:{q:"removed:true"},desc:"View removed"},{icon:"trash",query:{q:"trashed:true"},desc:"View trash"}]),we=me(()=>new Set(ee().map(t=>t.query.q))),Se=je(t=>{w(t?.q)||we().has(t.q)||v.value.some(e=>e.q===t.q)||(t.q=P(t.q).trim(),t.q.startsWith(P(v.value[0]?.q))?v.value[0]=t:v.value.unshift(t),v.value.length>7&&(v.value.length=7),window.localStorage?.setItem("priorQueries",et(v.value)))},1e3),_e=I(()=>_(c.query).title+" (click to toggle)"),Ce=I(()=>_(c.query).icon),xe=I(()=>h.value?.nextOffset!=null),Te=I(()=>["gallery","leaf",g.value]);function Ae(){return We()}function Oe(){de(C.value)&&Q.push({path:"/search",query:{q:C.value}})}function te(){return{path:c.path,query:{...c.query,ts:Date.now()}}}function Me(){const t=_(c.query);Q.replace({query:{...c.query,orderby:t.orderby,asc:ue(!t.asc)}})}function se(t){const e=_(c.query);Q.replace({query:{...c.query,orderby:e.orderby,asc:ue(t)}})}function $e(){v.value=[],window.localStorage?.removeItem("priorQueries")}async function $(t){try{const e=Xe({...t??c.query},"q","orderby","asc");D(()=>document.getElementById("search")?.focus()),C.value=P(e.q);const i=fe(e);if(w(i)||w(e.q))k.value=void 0,a.value=void 0,h.value=void 0,be.value=void 0;else{const f=await R("/api/search"+i);f!=null&&(k.value=f.assetIds,a.value=f.banner,h.value=f.query,B(f.assetIds)&&Se(e),D(()=>{L().onChange(),ae().onChange()}))}}catch(e){T({text:"Search failed",error:tt(e)})}}async function Ie(){const t=G.value;if(t==null||!He(t))return;const e=h.value?.nextOffset;if(h.value==null||e==null||k.value==null){T({text:"Sorry, there was an internal error",details:"loadMore(): unexpected missing context"});return}const f="/api/search"+fe({...h.value,offset:e}),o=await R(f);ce(k.value)||ce(o?.assetIds)?t.remove():(Ze(k.value,...o.assetIds),h.value.nextOffset=o.query.nextOffset),D(()=>{L().onChange(),ae().onChange()})}async function Pe(){if(a.value?.buttonClass==="disabled"&&de(a.value?.buttonTitle)){T({text:a.value.buttonTitle??void 0});return}if(a.value==null||w(a.value.prompt)||w(a.value.formAction)){T({text:"Sorry, there was an internal error",details:"bannerClick(): banner.prompt or formAction was missing"});return}const t=a.value,e=await ye.promptModal({title:t.promptTitle??null,message:t.prompt??null,okClass:t.buttonClass??null,okText:t.buttonText??null,okIcon:t.buttonIcon??null,promptType:"number",promptPlaceholder:t.promptPlaceholder??null});if(e?.ok===!1)return;if(e?.ok===!0&&w(e.prompt)){T({text:"Canceled",details:"Please enter the correct number.",type:"warning"});return}(await R(a.value.formAction,{method:"POST",timeoutMs:5*at,data:{answer:e.prompt}}))?.reload===!0&&await $()}return Qe(()=>{document.title="Search - PhotoStructure",$(c.query)}),Ee(async()=>{a.value?.refreshOnActivation===!0&&await $()}),re(()=>c.query,t=>{$(t)}),re(A,()=>{ze(()=>{L().onChange()})}),(t,e)=>{const i=ne("router-link"),f=ne("tt");return u(),d("div",ut,[s("header",ct,[s("div",dt,[r(rt),r(nt),r(i,{to:Ae(),"data-key":"h","data-key2":"esc",title:"Home",class:"no-drag vicon hide-on-m"},{default:p(()=>[r(l,{icon:"home"})]),_:1},8,["to"])]),s("form",{class:"search-input left-middle-right",title:"Search your library",onSubmit:Ne(Oe,["prevent"])},[s("button",ft,[r(l,{icon:"search"})]),Re(s("input",{id:"search",class:"search",type:"search",name:"q","onUpdate:modelValue":e[0]||(e[0]=o=>C.value=o),autofocus:""},null,512),[[Le,C.value]]),s("button",{type:"button",class:"no-drag vicon",title:_e.value,onClick:Me},[r(l,{icon:Ce.value},null,8,["icon"])],8,mt),r(i,{class:"no-drag vicon hide-on-s",to:te(),title:"Refresh search results"},{default:p(()=>[r(l,{icon:"refresh"})]),_:1},8,["to"]),r(i,{class:"no-drag vicon hide-on-s",to:"/search",title:"Reset search"},{default:p(()=>[r(l,{icon:"close"})]),_:1})],32),s("div",vt,[r(lt,{class:"hide-on-l"}),r(ot,{class:"header-overflow only-on-l",title:"View options"},{dropdown:p(()=>[n(ie)?(u(),d("a",{key:0,onClick:e[1]||(e[1]=(...o)=>n(J)&&n(J)(...o))},[r(l,{icon:n(H)?"fullscreen_exit":"fullscreen"},null,8,["icon"]),s("span",null,x(n(H)?"Exit full screen":"Full screen"),1)])):b("",!0),n(ie)?(u(),d("hr",yt)):b("",!0),s("div",pt,[e[15]||(e[15]=s("span",{class:"label"},"Sort",-1)),s("div",ht,[s("button",{class:m({selected:!_(n(c).query).asc}),title:"Newest first",onClick:e[2]||(e[2]=o=>se(!1))},[r(l,{icon:"sort_desc"}),e[13]||(e[13]=y(" Newest ",-1))],2),s("button",{class:m({selected:_(n(c).query).asc}),title:"Oldest first",onClick:e[3]||(e[3]=o=>se(!0))},[r(l,{icon:"sort_asc"}),e[14]||(e[14]=y(" Oldest ",-1))],2)])]),s("div",bt,[e[18]||(e[18]=s("span",{class:"label"},"Fit",-1)),s("div",gt,[s("button",{class:m({selected:n(A)==="square"}),title:"Square thumbnails",onClick:e[4]||(e[4]=o=>n(Y)("square"))},[r(l,{icon:"grid_square"}),e[16]||(e[16]=y(" Square ",-1))],2),s("button",{class:m({selected:n(A)==="aspect"}),title:"Original aspect ratio",onClick:e[5]||(e[5]=o=>n(Y)("aspect"))},[r(l,{icon:"grid_aspect"}),e[17]||(e[17]=y(" Original ",-1))],2)])]),s("div",kt,[e[19]||(e[19]=s("span",{class:"label"},"Size",-1)),s("div",qt,[s("button",{class:m({selected:n(g)==="s"}),title:"Small",onClick:e[6]||(e[6]=o=>n(S)("s"))}," Small ",2),s("button",{class:m({selected:n(g)==="m"}),title:"Medium",onClick:e[7]||(e[7]=o=>n(S)("m"))}," Medium ",2),s("button",{class:m({selected:n(g)==="l"}),title:"Large",onClick:e[8]||(e[8]=o=>n(S)("l"))}," Large ",2)])]),e[22]||(e[22]=s("hr",null,null,-1)),r(i,{to:te()},{default:p(()=>[r(l,{icon:"refresh"}),e[20]||(e[20]=s("span",null,"Refresh results",-1))]),_:1},8,["to"]),r(i,{to:"/search"},{default:p(()=>[r(l,{icon:"close"}),e[21]||(e[21]=s("span",null,"Reset search",-1))]),_:1})]),default:p(()=>[r(l,{icon:"more_vert"})]),_:1}),s("a",{class:"no-drag vicon hide-on-l",onClick:e[9]||(e[9]=(...o)=>n(W)&&n(W)(...o)),title:n(he),"data-key":"g"},[r(l,{icon:n(pe)},null,8,["icon"])],8,wt),s("div",St,[s("button",{class:m({selected:n(g)==="s"}),title:"Show small thumbnails",onClick:e[10]||(e[10]=o=>n(S)("s"))},[r(l,{icon:"sq_x4"})],2),s("button",{class:m({selected:n(g)==="m"}),title:"Show medium thumbnails",onClick:e[11]||(e[11]=o=>n(S)("m"))},[r(l,{icon:"sq_x3"})],2),s("button",{class:m({selected:n(g)==="l"}),title:"Show large thumbnails",onClick:e[12]||(e[12]=o=>n(S)("l"))},[r(l,{icon:"sq_x2"})],2)])])]),s("main",null,[a.value?(u(),d("div",_t,[y(x(a.value.description)+" ",1),a.value.buttonText?(u(),d("button",{key:0,class:m(["btn small",a.value.buttonClass]),title:a.value.buttonTitle??void 0,onClick:Pe},[a.value.buttonIcon?(u(),le(l,{key:0,icon:a.value.buttonIcon},null,8,["icon"])):b("",!0),y(" "+x(a.value.buttonText),1)],10,Ct)):b("",!0)])):b("",!0),n(B)(k.value)?(u(),d("div",{key:1,class:m([Te.value,"first"])},[(u(!0),d(E,null,N(k.value,o=>(u(),le(st,{key:n(A)+"-srch:"+n(Je)(o),id:o,lazy:!0},null,8,["id"]))),128))],2)):b("",!0),xe.value?(u(),d("div",{ref_key:"loadMoreEl",ref:G,class:"intersection-target next-btn next-assets reveal2s",key:"nextoffset:"+h.value?.nextOffset,onClick:Ie}," Load more… ")):b("",!0),s("div",xt,[n(B)(v.value)?(u(),d("div",Tt,[s("h2",null,[e[23]||(e[23]=y(" Prior searches ",-1)),s("a",{class:"vicon clear-prior-searches",title:"Clear prior searches",onClick:$e},[r(l,{icon:"close"})])]),s("ul",At,[(u(!0),d(E,null,N(v.value,o=>(u(),d("li",{key:JSON.stringify(o)},[r(i,{to:{name:"search",query:Z(o)}},{default:p(()=>[r(l,{icon:"search"}),r(f,null,{default:p(()=>[y(x(o.q),1)]),_:2},1024)]),_:2},1032,["to"])]))),128))])])):b("",!0),e[26]||(e[26]=s("h2",null,"Search examples",-1)),s("ul",null,[(u(!0),d(E,null,N(n(ee)(),o=>(u(),d("li",{key:o.query.q},[r(i,{to:{name:"search",query:{...Z(o.query),ts:Date.now()}}},{default:p(()=>[r(l,{icon:o.icon},null,8,["icon"]),y(" "+x(o.desc),1)]),_:2},1032,["to"])]))),128))]),e[27]||(e[27]=s("h2",null,"Learn more",-1)),s("ul",null,[s("li",null,[s("a",Ot,[r(l,{icon:"menu_book"}),e[24]||(e[24]=y(" Advanced query guide ",-1))])]),s("li",null,[s("a",Mt,[r(l,{icon:"forum"}),e[25]||(e[25]=y(" Suggest other searches on the forum ",-1))])])])])])])}}});export{jt as default};
