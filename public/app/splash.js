/**
 * Copyright Â© 2026, PhotoStructure Inc. All rights reserved.
 *
 * BY USING THIS SOFTWARE, YOU ACCEPT ALL OF THE TERMS IN
 * https://photostructure.com/eula
 * IF YOU DO NOT ACCEPT THESE TERMS, DO NOT USE THIS SOFTWARE
 */
import{H as a}from"./Blank.js";import{r as m}from"./Random.js";let d=!1;window?.addEventListener("beforeunload",()=>{d=!0});function v(){return d}const l=10,p=500,E=1500,f=1.5,w=1,y=6;function S(){setTimeout(()=>window.location.replace("/"),E)}function b(){const g=m(w,y),u=document.getElementById("bg");u.style.backgroundImage=`url("/images/splashbg${g}-1024w.jpg")`;const t=document.getElementById("msg"),i=document.getElementById("version");if(window.EventSource==null){t.innerHTML='<a href="https://caniuse.com/eventsource" target="_top">EventSource</a> not supported: please upgrade to a modern browser.';return}let n=0,s=!1;function c(){const r=new window.EventSource("/sse/splash"),o=r;o.addEventListener("error",()=>{if(console.log("sse on error",{retryCount:n,settled:s}),r.close(),v()||s){console.warn("Ignoring EventSource error while navigating/settled");return}if(n++,n<=l){t.textContent=`Restarting... (attempt ${n}/${l})`;const e=p*Math.pow(f,n-1);console.log(`Retrying SSE connection in ${e}ms...`),setTimeout(c,e)}else t.innerHTML=`Can't connect to server. <a href="/splash">Reload</a> to try again.`}),o.addEventListener("open",()=>{console.log("sse connected"),n=0}),o.addEventListener("version",e=>{console.log("sse on version",e.data),i.textContent=a(e.data)??i.textContent}),o.addEventListener("msg",e=>{console.log("sse on msg",e.data),t.textContent=a(e.data)??t.textContent}),o.addEventListener("settled",e=>{console.log("sse on settled",e.data),s=!0,t.textContent=a(e.data)??t.textContent,S(),r.close()})}c()}window.addEventListener("load",()=>b());
