/**
 * Copyright © 2026, PhotoStructure Inc. All rights reserved.
 *
 * BY USING THIS SOFTWARE, YOU ACCEPT ALL OF THE TERMS IN
 * https://photostructure.com/eula
 * IF YOU DO NOT ACCEPT THESE TERMS, DO NOT USE THIS SOFTWARE
 */
import{d as Q,r as x,D as X,c as Y,U as Z,W as ee,X as te,R as ne,k as m,B as d,m as t,E as p,_ as f,j as I,l as w,t as M,P as S,Q as $,A as N,z as D,u as b,o as se,g as V,C as le,L as oe,Z as ie,$ as re}from"./Touch.js";import{o as ae}from"./onReady.js";import{j as U,t as z}from"./Blank.js";import{_ as ce}from"./DropDown.vue_vue_type_script_setup_true_lang.js";import{s as B,c as ue,d as de}from"./Lazy.js";import"./Maybe.js";function F(i,n,l){const r=n.global?n:new RegExp(n.source,n.flags+"g");return i.replace(r,(...o)=>{const h=o.slice(0,-2);return h.index=o[o.length-2],h.input=o[o.length-1],l(h)})}function J(i){let n=i.replace(/</g,"&lt;").replace(/^---$/gm,"<hr/>").replace(/^ *- (.*)$/gm,(l,r)=>"<li>"+r.trim()+"</li>");return n=F(n,/```([^`]+)```/g,l=>`<code>${l[1]}</code>`),n=F(n,/\*\*([^*]+)\*\*/,l=>`<b>${l[1]}</b>`),n=fe(n),n}function he(i){const n=i.trim(),l=n.startsWith(":"),r=n.endsWith(":");return l&&r?"center":r?"right":"left"}function me(i){return i.split("|").map(he)}function L(i,n,l){return"<tr>"+i.map((r,o)=>{const h=l[o];return`<${n}${h==="center"?' class="ta-center"':h==="right"?' class="ta-right"':""}>${r}</${n}>`}).join("")+"</tr>"}function fe(i){const n=i.split(`
`),l=[];let r=!1,o=null,h=!1,g=[];for(const k of n){const v=k.match(/^\|(.+)\|$/);if(v!=null){const _=v[1];if(/^[-:\s|]+$/.test(_)){g=me(_),o!=null&&(l.push(L(o,"th",g)),o=null,h=!0);continue}r||(l.push('<table class="bmd">'),r=!0,g=[],h=!1);const E=_.split("|").map(T=>T.trim());!h&&o==null?o=E:(o!=null&&(l.push(L(o,"th",g)),o=null,h=!0),l.push(L(E,"td",g)))}else r&&(o!=null&&(l.push(L(o,"th",g)),o=null),l.push("</table>"),r=!1),l.push(k)}return r&&(o!=null&&l.push(L(o,"th",g)),l.push("</table>")),l.join(`
`)}B("loading","welcome","ready","failed");const q=B("Summary","Library","System","Tools"),pe={Summary:"bookmark-tabs",Library:"library",System:"computer",Tools:"wrench"},A=B("error","no-library","pending","stop-sync","warn","ok","disabled"),ve=[A.ok,A.disabled,A.pending];function ge(i){return!ve.includes(i)}const ye={pending:"busy-dots","no-library":"new-yellow",ok:"green-check",warn:"warning","stop-sync":"pause",error:"error",disabled:"sleeping-face-desat"};function be(i){return ye[i]}const ke={pending:"Health checks are running...","no-library":"No library is open",ok:"OK",warn:"Warning","stop-sync":"Some health checks are preventing sync from running",error:"Some health checks failed: sync will not run",disabled:"Some health checks are disabled"},we={id:"summary",section:q.Summary};function _e(){return q.values.map(i=>({section:i,emoji:pe[i],results:i==="Summary"?[{...we,level:"pending",settled:!1,ts:Date.now(),msg:["⌚ Requesting health check results..."]}]:[]}))}const Ce={class:"reveal bg-color-gradient left-middle-right"},Se={class:"left"},$e={class:"vicon",href:"/",title:"Return home"},Le={href:"/about"},Ee={href:"/settings"},Te={href:"/splash"},Re={class:"vicon hide-on-m",href:"/about",title:"About"},Me={class:"vicon hide-on-m",href:"/settings",title:"Settings"},je={class:"vicon hide-on-m",href:"/splash",title:"Splash"},He={class:"right"},xe={class:"reveal"},Ne={key:0,class:"sse-error"},De={key:0,class:"health loading"},Ae=["id"],Be=["title"],We=["innerHTML"],Oe=["innerHTML"],Pe={key:0,class:"links"},Ie=["href","title","target"],Ve={key:0,class:"buttons"},Ue=["onClick","title"],K=10,ze=500,Fe=1.5,Je=Q({__name:"Health",setup(i){const n=x(_e()),l=x(Date.now()),r=x(null),o=X(),h=Y(()=>n.value.flatMap(c=>c.results.filter(e=>ge(e.level))));async function g(){const c=n.value.flatMap(y=>y.results),e=h.value.length>0?h.value:c,u=e.map(({buttons:y,links:C,...R})=>R),a=JSON.stringify(u,null,2),s=h.value.length>0?"problem(s)":"result(s)";try{await navigator.clipboard.writeText(a),o.show({text:`Copied ${e.length} ${s} to clipboard`,type:"info",timeout:2e3})}catch{o.show({text:"Failed to copy to clipboard",type:"error",timeout:3e3})}}let k,v;function _(){l.value=Date.now()}function E(c){return ke[c]}function T(c){const e=c.method??"POST";e==="GET"?document.location.assign(c.url):le(c.url,{method:e})}function W(){oe()}async function O(){T({url:"/admin/restart"}),await de(1200),location.reload()}function G(c){for(const e of c.target.getElementsByTagName("summary"))e.dispatchEvent(new MouseEvent("click",{bubbles:!1}))}return Z(()=>{k=setInterval(_,5e3);const c=new URLSearchParams(window.location.search).get("test");(c==="warn"||c==="error")&&n.value.find(s=>s.section==="Library")?.results.push({id:"test-"+c,section:"Library",level:c,msg:[`Test ${c} message`,"This is a fake health check for testing the copy button."],ts:Date.now()});let e=0,u=!1;function a(){r.value=null,v=new window.EventSource("/sse/health");const s=v;s.addEventListener("error",()=>{if(v?.close(),v=void 0,!u)if(e++,e<=K){const y=ze*Math.pow(Fe,e-1);r.value=`Reconnecting... (attempt ${e}/${K})`,setTimeout(a,y)}else r.value="Connection lost. Reload the page to try again."},!1),s.addEventListener("done",()=>{u=!0,v?.close(),v=void 0},!1),s.addEventListener("result",y=>{e=0,r.value=null;const C=JSON.parse(y.data),R=n.value.find(H=>H.section===C.section);if(R==null)return;const j=R.results,P=j.findIndex(H=>H.id===C.id);P===-1?j.push(C):j[P]=C},!1)}a()}),ee(()=>{k!=null&&(clearInterval(k),k=void 0),v!=null&&(v.close(),v=void 0)}),te((c,e,u)=>(ne({error:c,details:u}),!0)),(c,e)=>(d(),m("div",null,[t("header",Ce,[t("div",Se,[t("a",$e,[p(f,{icon:"home"})]),p(ce,{class:"header-overflow only-on-s-m",title:"Menu"},{dropdown:I(()=>[t("a",Le,[p(f,{icon:"info"}),e[5]||(e[5]=t("span",null,"About",-1))]),t("a",Ee,[p(f,{icon:"settings"}),e[6]||(e[6]=t("span",null,"Settings",-1))]),e[10]||(e[10]=t("hr",null,null,-1)),t("a",{onClick:e[0]||(e[0]=u=>O())},[p(f,{icon:"refresh"}),e[7]||(e[7]=t("span",null,"Restart",-1))]),t("a",Te,[p(f,{icon:"surfing"}),e[8]||(e[8]=t("span",null,"Splash",-1))]),t("a",{onClick:e[1]||(e[1]=u=>W())},[p(f,{icon:"power"}),e[9]||(e[9]=t("span",null,"Shut down",-1))])]),default:I(()=>[p(f,{icon:"more_vert"})]),_:1}),t("a",Re,[p(f,{icon:"info"})]),t("a",Me,[p(f,{icon:"settings"})]),t("a",{class:"vicon hide-on-m",onClick:e[2]||(e[2]=u=>O()),title:"Restart webserver"},[p(f,{icon:"refresh"})]),t("a",je,[p(f,{icon:"surfing"})]),t("a",{class:"vicon hide-on-m",onClick:e[3]||(e[3]=u=>W()),title:"Shut down PhotoStructure. Your library will no longer be accessible until you re-launch PhotoStructure."},[p(f,{icon:"power"})])]),e[11]||(e[11]=t("div",{class:"title"},[t("img",{class:"logo",src:"/images/logo-white.svg"}),t("div",{class:"text"},"Health")],-1)),t("div",He,[t("a",{class:"vicon",onClick:e[4]||(e[4]=u=>g()),title:"Copy results to clipboard"},[p(f,{icon:"content_paste"})])])]),t("main",xe,[r.value?(d(),m("div",Ne,[e[12]||(e[12]=t("i",{class:"emj warning"},null,-1)),t("span",null,M(r.value),1)])):w("",!0),(d(!0),m(S,null,$(n.value,u=>(d(),m("section",{key:"section:"+u.section},[t("h2",null,[t("i",{class:D(["emj med",u.emoji])},null,2),N(" "+M(u.section),1)]),t("ul",null,[u.results.length===0?(d(),m("li",De,[...e[13]||(e[13]=[t("i",{class:"emj busy-dots"},null,-1),t("span",null,"Loading...",-1)])])):w("",!0),(d(!0),m(S,null,$(u.results,a=>(d(),m("li",{class:"health anim-flash",key:a.id+"-"+a.ts,id:a.id},[t("i",{class:D(["emj",b(be)(a.level)]),title:a.id+": "+E(a.level)+" "+b(ue)(l.value-a.ts)},null,10,Be),t("details",{class:D(a.level),onClick:se(G,["self"])},[t("summary",{title:"Click to toggle details",innerHTML:b(J)(a.msg[0])},null,8,We),(d(!0),m(S,null,$(a.msg.slice(1),(s,y)=>(d(),m("p",{class:"msg",key:y,innerHTML:b(J)(s)},null,8,Oe))),128)),b(U)(a.links)?(d(),m("ul",Pe,[(d(!0),m(S,null,$(b(z)(a.links),s=>(d(),m("li",{key:a.id+":"+s.url},[t("a",{href:s.url,title:s.title??"Click to open "+s.url+(s.url.startsWith("/")?"":" in a new window"),target:s.url.startsWith("/")?"_self":"_blank"},[s.icon?(d(),V(f,{key:0,icon:s.icon},null,8,["icon"])):w("",!0),N(" "+M(s.text),1)],8,Ie)]))),128))])):w("",!0)],2),b(U)(a.buttons)?(d(),m("ul",Ve,[(d(!0),m(S,null,$(b(z)(a.buttons),s=>(d(),m("li",{key:a.id+":"+s.url},[t("button",{class:"btn small",onClick:y=>T(s),title:s.title??void 0},[s.icon?(d(),V(f,{key:0,icon:s.icon},null,8,["icon"])):w("",!0),N(" "+M(s.text),1)],8,Ue)]))),128))])):w("",!0)],8,Ae))),128))])]))),128))])]))}});ae(()=>{const i=ie(Je);i.use(re()),i.mount("#mount")});
