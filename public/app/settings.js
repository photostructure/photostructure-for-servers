/**
 * Copyright Â© 2026, PhotoStructure Inc. All rights reserved.
 *
 * BY USING THIS SOFTWARE, YOU ACCEPT ALL OF THE TERMS IN
 * https://photostructure.com/eula
 * IF YOU DO NOT ACCEPT THESE TERMS, DO NOT USE THIS SOFTWARE
 */
import{a as h}from"./AddTitlesToLinks.js";import{a as c,p as d,n as p,q as l,$ as m}from"./fe.js";import{o as f}from"./onReady.js";import{i as u,S as v}from"./StickyHeader.js";import{b as y,t as b,m as S,c as k,M as E,j as w}from"./Blank.js";import{d as C,m as r}from"./Maybe.js";import"./Lazy.js";class L{constructor(t){if(this.label=t,this.label==null)throw new Error(t+" had no label parent");if(this.radio=this.label.querySelector("input[type=radio]"),this.radio==null)throw new Error(t+" had no radio sibling");if(c(this.label,"form")?.addEventListener("submit",e=>this.onSubmit(e)),this.inputContainer=C(this.label.querySelector(".input-container")),this.input=this.inputContainer==null?this.label.querySelector("input[type=text]"):void 0,this.input==null&&this.inputContainer==null)throw new Error("no sibling text input found for "+this.label);if(r(this.input,e=>this.checkUnc(e)),this.multiSelections=this.inputContainer!=null,this.inputName=this.label.getAttribute("for"),this.multiSelections&&y(this.inputName))throw new Error(this.label+" had no data-name");if(u()&&__ps!=null){const e=this.label.querySelector("button.select-directory"),i={title:e.dataset.title??"Select a directory",properties:["openDirectory","createDirectory","promptToCreate"]};this.multiSelections&&i.properties?.push("multiSelections"),e.addEventListener("click",async()=>{this.setCheck();const o=await __ps.showOpenDialog(i);this.addPaths(b(o.filePaths),!0)})}if(this.multiSelections&&this.inputContainer!=null){this.placeholder=this.inputContainer.dataset.placeholder,this.addPaths(S(this.inputContainer.dataset.paths,JSON.parse),!1);for(const e of this.label.querySelectorAll("[data-path]"))r(e.dataset.path,i=>e.addEventListener("click",()=>{this.addPaths([i],!0),this.setCheck()}))}r(this.input,e=>this.checkOnFocus(e)),this.label.classList.add("ready")}id=1;inputName;radio;multiSelections;inputContainer;placeholder;input;checkUnc(t){t.addEventListener("keyup",()=>this.uncNope(t)),t.addEventListener("blur",()=>this.uncNope(t)),t.addEventListener("change",()=>this.uncNope(t))}uncNope(t){t.value.startsWith("\\\\")===!0?(t.title="UNC pathnames are not monitored for free disk space. Please map this volume to a drive letter instead.",t.classList.add("warn")):(t.title="",t.classList.remove("warn"))}onSubmit(t){this.rmPath("")}checkOnFocus(t){t.addEventListener("input",()=>this.setCheck())}setCheck(){if(r(this.radio,t=>t.checked=!0),this.multiSelections){this.addPath("");for(const t of this.label.querySelectorAll("input[type=text]"))t.value.startsWith("file://")===!0&&(t.value=t.value.slice(7))}}currentValues(){return[...this.label.querySelectorAll("input[type=text]")].map(t=>k(t.value).trim())}rmPath(t){if(this.inputContainer!=null)for(const e of this.inputContainer.querySelectorAll("input"))e.value===t&&(e.remove(),this.inputContainer.querySelector("button[for="+e.id+"]")?.remove())}addPaths(t,e){const i=E(t);if(i.length>0){this.multiSelections&&this.rmPath("");for(const o of i)r(this.addPath(o),s=>{e&&(s.classList.add("anim-flash"),setTimeout(()=>s.classList.remove("anim-flash"),1e3))})}this.multiSelections&&(this.addPath(""),w(t)&&this.setFocus(""))}setFocus(t){if(this.inputContainer!=null){for(const e of this.inputContainer.querySelectorAll("input"))if(e.value===t){e.focus({preventScroll:!0});return}}}addPath(t){if(this.input!=null)return this.input.value=t,this.input;const e=this.inputContainer;for(const a of e.querySelectorAll("input"))if(a.value===t)return a;const i=document.createElement("input"),o=this.id++;i.id=e.id+o,i.name=this.inputName,i.classList.add("select-directory-path"),r(this.placeholder,a=>i.placeholder=a),i.type="text",i.value=t,this.checkUnc(i),this.checkOnFocus(i),i.addEventListener("keydown",a=>{(a.key==="Enter"||a.code==="Enter")&&(a.shiftKey?d(i,"input")?.focus():p(i,"input")?.focus())});const s=document.createElement("button");return s.setAttribute("for",i.id),s.classList.add("delete-directory-path"),s.type="button",s.title="Remove this path",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>',s.addEventListener("click",()=>{s.remove(),i.remove(),this.addPath("")}),e.appendChild(i),e.appendChild(s),i}}f(()=>{new v,u()&&__ps!=null&&l(".hidden.only-electron").forEach(n=>n.classList.remove("hidden"));for(const n of l("label.path-component"))new L(n);h(),m("form")?.addEventListener("keydown",n=>{(n.key==="Enter"||n.code==="Enter")&&n.preventDefault()}),window.addEventListener("submit",()=>{l(".modal").forEach(n=>n.classList.remove("hidden"))})});
